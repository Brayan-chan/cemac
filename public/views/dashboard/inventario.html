<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEMAC - Inventario</title>
    <link rel="stylesheet" href="/css/customsidebar.css">
    <link rel="stylesheet" href="/css/inicio.css">
    <link rel="stylesheet" href="/css/inventario.css">
    <link rel="stylesheet" href="/css/categories.css">
    <link rel="stylesheet" href="/css/search.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dmyejrbs7/image/upload/v1757894655/CEMAC-LOGO_nrow82.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/tailwind.config.js"></script>
    <script src="/js/utils/sidebarPreloader.js"></script>
    <style>
        /* Box management toggle styles */
        #enableBoxes:checked + div .box-toggle-bg {
            background-color: #3B82F6;
        }
        #enableBoxes:checked + div .box-toggle-dot {
            transform: translateX(1rem);
        }
        .box-toggle-dot {
            transition: transform 0.2s ease-in-out;
        }
        .box-toggle-bg {
            transition: background-color 0.2s ease-in-out;
        }
    </style>
</head>
<body class="h-full bg-gray-50">
    <!-- Sidebar Container - Será poblado por SidebarComponent -->
    <div id="sidebar" class="fixed left-0 top-0 bg-[#8B7EC7] sidebar-expanded sidebar-transition z-40 sidebar-flex"></div>

    <div id="mainContent" class="main-expanded sidebar-transition">
        <header class="bg-white h-16 border-b border-gray-200">
            <div class="flex items-center justify-between h-full px-6">
                <div class="w-64"></div>
                
                <div class="flex-1 flex justify-center">
                    <div class="relative w-full max-w-md mx-4">
                        <input id="headerSearch" type="text" placeholder="Buscar producto..." class="w-full bg-gray-100 border-0 rounded-full px-4 py-2 pl-10 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-[#8B7EC7]">
                        <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
                            <i id="searchIcon" class="fas fa-search text-gray-400"></i>
                            <i id="searchLoading" class="fas fa-spinner fa-spin text-gray-400 hidden"></i>
                        </div>
                        <button id="clearSearch" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="w-64 flex items-center justify-end space-x-2">
                    <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <i class="far fa-envelope text-gray-600 text-xl"></i>
                    </button>
                    
                    <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors relative">
                        <i class="far fa-bell text-gray-600 text-xl"></i>
                        <span class="absolute top-1 right-1 w-4 h-4 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                    </button>

                    <div class="w-px h-6 bg-gray-300 mx-2"></div>
                    
                    <div id="userMenuContainer"></div>
                </div>
            </div>
        </header>

        <main class="flex flex-col h-[calc(100vh-4rem)] bg-gray-50">
            <div class="flex-1 overflow-auto p-6">
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-3xl font-bold text-gray-900">Inventario</h1>
                    <div class="flex items-center gap-3">
                        <button id="manageSuppliersBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2">
                            <i class="fas fa-solid fa-users"></i>
                            <span>Proveedores</span>
                        </button>
                        <button id="manageBrandsBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2">
                            <i class="fas fa-tags"></i>
                            <span>Marcas</span>
                        </button>
                        <button id="manageCategoriesBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center gap-2">
                            <i class="fas fa-tags"></i>
                            <span>Categorías</span>
                        </button>
                        <button id="addProductBtn" class="px-6 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            <span>Agregar Producto</span>
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
                            <select id="categoryFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="">Todas las categorías</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Marca</label>
                            <select id="brandFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="">Todas las marcas</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Proveedor</label>
                            <select id="supplierFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="">Todos los proveedores</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rango de Precio</label>
                            <select id="priceFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="">Todos los precios</option>
                                <option value="0-50">$0 - $50</option>
                                <option value="50-100">$50 - $100</option>
                                <option value="100-500">$100 - $500</option>
                                <option value="500+">$500+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Disponibilidad</label>
                            <select id="statusFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="">Todas las disponibilidades</option>
                                <option value="limited">Stock limitado</option>
                                <option value="unlimited">Stock ilimitado</option>
                                <option value="out-of-stock">Agotado</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ordenar por</label>
                            <select id="sortFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7]">
                                <option value="name-asc">Nombre (A-Z)</option>
                                <option value="name-desc">Nombre (Z-A)</option>
                                <option value="price-asc">Precio (menor a mayor)</option>
                                <option value="price-desc">Precio (mayor a menor)</option>
                                <option value="stock-asc">Stock (menor a mayor)</option>
                                <option value="stock-desc">Stock (mayor a menor)</option>
                                <option value="createdAt-desc">Más recientes</option>
                                <option value="createdAt-asc">Más antiguos</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Botones de filtros -->
                    <div class="flex items-center gap-3 mt-4 pt-4 border-t border-gray-200">
                        <button id="clearFiltersBtn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
                            <i class="fas fa-times text-sm"></i>
                            <span>Limpiar filtros</span>
                        </button>
                        <div class="flex-1"></div>
                        <div id="filtersApplied" class="hidden text-sm text-blue-600 flex items-center gap-1">
                            <i class="fas fa-filter text-xs"></i>
                            <span>Filtros aplicados</span>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Productos -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Producto</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Categoría</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Marca</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Proveedor</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Precio</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Stock</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Estado</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody" class="divide-y divide-gray-200">
                                <!-- Productos se cargan aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="loadingState" class="hidden p-8 text-center">
                        <div class="inline-flex items-center space-x-2">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#8B7EC7]"></div>
                            <span class="text-gray-600">Cargando productos...</span>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="hidden p-8 text-center">
                        <div class="text-gray-500">
                            <i class="fas fa-box-open text-4xl mb-4"></i>
                            <p class="text-lg font-medium">No hay productos</p>
                            <p class="text-sm">Agrega tu primer producto para comenzar</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paginador -->
            <div id="paginationContainer" class="flex items-center justify-center space-x-2 py-4 bg-white border-t border-gray-200">
                <button id="prevPageBtn" class="flex items-center px-3 py-2 text-gray-500 hover:text-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left mr-2 text-sm"></i>
                    Anterior
                </button>
                
                <div id="paginationNumbers" class="flex items-center space-x-1">
                    <!-- Números de página se cargan aquí -->
                </div>
                
                <button id="nextPageBtn" class="flex items-center px-3 py-2 text-gray-500 hover:text-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Siguiente
                    <i class="fas fa-chevron-right ml-2 text-sm"></i>
                </button>
                
                <span class="text-gray-600 text-sm ml-4">
                    Página <span id="currentPage">1</span> de <span id="totalPages">1</span>
                </span>
            </div>
        </main>
    </div>

    <!-- Modal para agregar producto -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200 bg-[#8B7EC7] text-white rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h2 id="modalTitle" class="text-lg font-semibold">Añadir producto</h2>
                    <button id="closeModal" class="text-white hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <form id="productForm" class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">
                                Nombre del Producto
                            </label>
                            <input type="text" id="nombre" name="nombre" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] focus:border-transparent"
                                placeholder="Libretas de cuadros chicos">
                        </div>

                        <div>
                            <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-2">
                                Descripción
                            </label>
                            <textarea id="descripcion" name="descripcion" rows="4"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] focus:border-transparent"
                                placeholder="Descripción detallada del producto..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Precio y Disponibilidad
                            </label>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label for="precio" class="block text-xs text-gray-500 mb-1">Precio</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" id="precio" name="precio" step="0.01" min="0" required
                                            class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7]"
                                            placeholder="50.00">
                                    </div>
                                </div>

                                <div>
                                    <label for="precioPromocional" class="block text-xs text-gray-500 mb-1">Precio Promocional</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" id="precioPromocional" name="precioPromocional" step="0.01" min="0"
                                            class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7]"
                                            placeholder="45.00">
                                    </div>
                                </div>

                                <div>
                                    <label for="stock" class="block text-xs text-gray-500 mb-1">Disponibilidad</label>
                                    <div class="relative">
                                        <input type="number" id="stock" name="stock" min="0" disabled
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] disabled:bg-gray-100"
                                            placeholder="∞">
                                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center">
                                            <input type="checkbox" id="disponible" name="disponible" checked
                                                class="text-[#8B7EC7] focus:ring-[#8B7EC7]">
                                            <label for="disponible" class="ml-1 text-xs text-gray-500">Ilimitado</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Nueva sección: Gestión por cajas -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-medium text-blue-700 flex items-center gap-2">
                                    <i class="fas fa-boxes"></i>
                                    Gestión por cajas (Opcional)
                                </h3>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enableBoxes" class="sr-only">
                                    <div class="relative">
                                        <div class="w-10 h-6 bg-gray-200 rounded-full shadow-inner transition-colors box-toggle-bg"></div>
                                        <div class="box-toggle-dot absolute w-4 h-4 bg-white rounded-full shadow -left-1 -top-1 transition-transform"></div>
                                    </div>
                                    <span class="ml-2 text-xs text-blue-600">Habilitar</span>
                                </label>
                            </div>
                            <p class="text-xs text-blue-600 mb-3">
                                Para productos que vienen en cajas/paquetes. Útil para mayoreo y gestión de inventario por lotes.
                            </p>
                            
                            <div id="boxManagementFields" class="hidden space-y-3">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="unitsPerBox" class="block text-xs text-blue-600 mb-1">Piezas por caja</label>
                                        <input type="number" id="unitsPerBox" name="unitsPerBox" min="1"
                                            class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                            placeholder="24">
                                    </div>
                                    <div>
                                        <label for="boxStock" class="block text-xs text-blue-600 mb-1">Cajas en stock</label>
                                        <input type="number" id="boxStock" name="boxStock" min="0"
                                            class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                            placeholder="10">
                                    </div>
                                </div>
                                <div id="stockCalculation" class="text-xs text-blue-600 bg-blue-100 p-2 rounded hidden">
                                    <span class="font-medium">Stock total calculado: </span>
                                    <span id="calculatedStock">0 piezas</span>
                                    <span class="text-blue-500 ml-2">(<span id="boxDisplay">0</span> cajas × <span id="unitsDisplay">0</span> piezas + <span id="looseDisplay">0</span> sueltas)</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Códigos del producto
                            </label>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="barcode" class="block text-xs text-gray-500 mb-1">Código de barras</label>
                                    <input type="text" id="barcode" name="barcode"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7]"
                                        placeholder="7501234567890">
                                </div>
                                <div>
                                    <label for="supplierCode" class="block text-xs text-gray-500 mb-1">Código proveedor</label>
                                    <input type="text" id="supplierCode" name="supplierCode"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7]"
                                        placeholder="PROV-2024-001">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Imagen del producto
                            </label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors">
                                <div class="space-y-2">
                                    <input type="file" id="imageInput" name="image" accept="image/*" class="hidden" />
                                    <div id="previewContainer" class="hidden mb-4">
                                        <img id="imagePreview" src="" alt="Vista previa" class="mx-auto max-h-48 object-contain mb-2" />
                                    </div>
                                    <i class="fas fa-image text-gray-400 text-3xl"></i>
                                    <p class="text-sm text-gray-500" id="uploadText">Cargar una imagen</p>
                                    <button type="button" id="uploadButton"
                                        class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50">
                                        <i class="fas fa-upload mr-2"></i>
                                        Seleccionar imagen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                Selección de categorías
                            </h3>
                            <p class="text-xs text-gray-500 mb-3">
                                Selecciona una categoría para organizar tu producto
                            </p>
                            <div class="category-selector">
                                <select id="categoria" name="categoria"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] mb-2">
                                    <option value="">Cargando categorías...</option>
                                </select>
                                <button type="button" id="addNewCategoryBtn" class="w-full px-3 py-2 border border-dashed border-gray-300 text-gray-600 rounded-lg hover:border-[#8B7EC7] hover:text-[#8B7EC7] transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-plus text-sm"></i>
                                    <span>Agregar nueva categoría</span>
                                </button>
                            </div>
                        </div>

                        <!-- Sección de Marca -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                Marca del producto
                            </h3>
                            <p class="text-xs text-gray-500 mb-3">
                                Selecciona la marca del producto
                            </p>
                            <div class="brand-selector">
                                <select id="marca" name="marca"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] mb-2">
                                    <option value="">Cargando marcas...</option>
                                </select>
                                <button type="button" id="addNewBrandBtn" class="w-full px-3 py-2 border border-dashed border-gray-300 text-gray-600 rounded-lg hover:border-[#8B7EC7] hover:text-[#8B7EC7] transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-plus text-sm"></i>
                                    <span>Agregar nueva marca</span>
                                </button>
                            </div>
                        </div>

                        <!-- Sección de Proveedor -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                Proveedor del producto
                            </h3>
                            <p class="text-xs text-gray-500 mb-3">
                                Selecciona el proveedor del producto
                            </p>
                            <div class="supplier-selector">
                                <select id="proveedor" name="proveedor"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#8B7EC7] mb-2">
                                    <option value="">Cargando proveedores...</option>
                                </select>
                                <button type="button" id="addNewSupplierBtn" class="w-full px-3 py-2 border border-dashed border-gray-300 text-gray-600 rounded-lg hover:border-[#8B7EC7] hover:text-[#8B7EC7] transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-plus text-sm"></i>
                                    <span>Agregar nuevo proveedor</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200 mt-6">
                    <button type="button" id="cancelBtn"
                        class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4]">
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para gestionar categorías -->
    <div id="manageCategoriesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 category-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden category-modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">Gestión de Categorías</h3>
                    <button id="closeCategoriesModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4 flex items-center gap-3">
                    <div class="flex-1">
                        <input type="text" id="categoriesSearchInput" placeholder="Buscar categorías..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7] category-search-input">
                    </div>
                    <button id="createCategoryBtn" class="px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span>Nueva</span>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="categoriesContainer">
                    <div class="category-loading">
                        <i class="fas fa-spinner"></i>
                        <span>Cargando categorías...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar categoría -->
    <div id="categoryFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 category-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full category-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="categoryFormTitle" class="text-lg font-semibold text-gray-900">Nueva Categoría</h3>
                    <button id="closeCategoryFormModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="categoryForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Categoría</label>
                        <input type="text" id="categoryName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Ej: Electrónica, Papelería...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
                        <textarea id="categoryDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Descripción de la categoría..."></textarea>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button type="button" id="cancelCategoryBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="saveCategoryBtn" class="flex-1 px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar categoría -->
    <div id="deleteCategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 category-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full category-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 text-center mb-2">¿Eliminar Categoría?</h3>
                <p id="deleteCategoryMessage" class="text-gray-600 text-center mb-6">¿Estás seguro de que deseas eliminar esta categoría?</p>
                <div class="flex gap-2">
                    <button id="cancelDeleteCategoryBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmDeleteCategoryBtn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para gestionar marcas -->
    <div id="manageBrandsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 brand-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden brand-modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">Gestión de Marcas</h3>
                    <button id="closeBrandsModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4 flex items-center gap-3">
                    <div class="flex-1">
                        <input type="text" id="brandsSearchInput" placeholder="Buscar marcas..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7] brand-search-input">
                    </div>
                    <button id="createBrandModalBtn" class="px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span>Nueva</span>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="brandsContainer">
                    <div class="brand-loading text-center py-8">
                        <i class="fas fa-spinner fa-spin text-[#8B7EC7] text-2xl mb-2"></i>
                        <div class="text-gray-600">Cargando marcas...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para gestionar proveedores -->
    <div id="manageSuppliersModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 supplier-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden supplier-modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">Gestión de Proveedores</h3>
                    <button id="closeSuppliersModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-4 flex items-center gap-3">
                    <div class="flex-1">
                        <input type="text" id="suppliersSearchInput" placeholder="Buscar proveedores..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-[#8B7EC7] focus:border-[#8B7EC7] supplier-search-input">
                    </div>
                    <button id="createSupplierModalBtn" class="px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span>Nuevo</span>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div id="suppliersContainer">
                    <div class="supplier-loading text-center py-8">
                        <i class="fas fa-spinner fa-spin text-[#8B7EC7] text-2xl mb-2"></i>
                        <div class="text-gray-600">Cargando proveedores...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar marca (versión gestión) -->
    <div id="brandManageFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 brand-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full brand-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="brandManageFormTitle" class="text-lg font-semibold text-gray-900">Nueva Marca</h3>
                    <button id="closeBrandManageFormModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="brandManageForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Marca</label>
                        <input type="text" id="brandManageName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Ej: Nike, Apple, Samsung...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
                        <textarea id="brandManageDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Descripción de la marca..."></textarea>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="brandManageIsActive" checked class="h-4 w-4 text-[#8B7EC7] focus:ring-[#8B7EC7] border-gray-300 rounded">
                        <label for="brandManageIsActive" class="ml-2 block text-sm text-gray-700">Marca activa</label>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button type="button" id="cancelBrandManageBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="saveBrandManageBtn" class="flex-1 px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar proveedor (versión gestión) -->
    <div id="supplierManageFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 supplier-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full supplier-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="supplierManageFormTitle" class="text-lg font-semibold text-gray-900">Nuevo Proveedor</h3>
                    <button id="closeSupplierManageFormModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="supplierManageForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Proveedor</label>
                        <input type="text" id="supplierManageName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Ej: Distribuidora ABC, Proveedor XYZ...">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email de Contacto</label>
                            <input type="email" id="supplierManageEmail" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="contacto@proveedor.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                            <input type="tel" id="supplierManagePhone" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="+52 55 1234 5678">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Dirección</label>
                        <textarea id="supplierManageAddress" rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Dirección del proveedor..."></textarea>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="supplierManageIsActive" checked class="h-4 w-4 text-[#8B7EC7] focus:ring-[#8B7EC7] border-gray-300 rounded">
                        <label for="supplierManageIsActive" class="ml-2 block text-sm text-gray-700">Proveedor activo</label>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button type="button" id="cancelSupplierManageBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="saveSupplierManageBtn" class="flex-1 px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar marca -->
    <div id="deleteBrandModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 brand-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full brand-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 text-center mb-2">¿Eliminar Marca?</h3>
                <p id="deleteBrandMessage" class="text-gray-600 text-center mb-6">¿Estás seguro de que deseas eliminar esta marca?</p>
                <div class="flex gap-2">
                    <button id="cancelDeleteBrandBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmDeleteBrandBtn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar proveedor -->
    <div id="deleteSupplierModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 supplier-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full supplier-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 text-center mb-2">¿Eliminar Proveedor?</h3>
                <p id="deleteSupplierMessage" class="text-gray-600 text-center mb-6">¿Estás seguro de que deseas eliminar este proveedor?</p>
                <div class="flex gap-2">
                    <button id="cancelDeleteSupplierBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmDeleteSupplierBtn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar marca (desde modal de producto) -->
    <div id="brandFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 brand-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full brand-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="brandFormTitle" class="text-lg font-semibold text-gray-900">Nueva Marca</h3>
                    <button id="closeBrandFormModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="brandForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de la Marca</label>
                        <input type="text" id="brandName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Ej: Nike, Apple, Samsung...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
                        <textarea id="brandDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Descripción de la marca..."></textarea>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button type="button" id="cancelBrandBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="saveBrandBtn" class="flex-1 px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para crear/editar proveedor -->
    <div id="supplierFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 supplier-modal">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full supplier-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="supplierFormTitle" class="text-lg font-semibold text-gray-900">Nuevo Proveedor</h3>
                    <button id="closeSupplierFormModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="supplierForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Proveedor</label>
                        <input type="text" id="supplierName" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Ej: Distribuidora ABC, Proveedor XYZ...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email de Contacto</label>
                        <input type="email" id="supplierEmail" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="contacto@proveedor.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                        <input type="tel" id="supplierPhone" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="+52 55 1234 5678">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Dirección (Opcional)</label>
                        <textarea id="supplierAddress" rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-[#8B7EC7] focus:border-[#8B7EC7]" placeholder="Dirección del proveedor..."></textarea>
                    </div>
                    <div class="flex gap-2 pt-4">
                        <button type="button" id="cancelSupplierBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="saveSupplierBtn" class="flex-1 px-4 py-2 bg-[#8B7EC7] text-white rounded-lg hover:bg-[#7A6DB4] transition-colors">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="/js/services/authService.js"></script>
    <script type="module" src="/js/utils/uiUtils.js"></script>
    <script type="module" src="/js/modules/dashboardHandler.js"></script>
    <script type="module" src="/js/services/categoryService.js"></script>
    <script type="module" src="/js/modules/categoryHandler.js"></script>
    <script type="module" src="/js/services/inventoryService.js"></script>
    <script type="module" src="/js/services/brandsService.js"></script>
    <script type="module" src="/js/services/suppliersService.js"></script>
    <script type="module" src="/js/modules/inventoryHandler.js"></script>
    <script type="module" src="/js/components/userMenuComponent.js"></script>
    <script type="module" src="/js/modules/userMenuHandler.js"></script>
    <script type="module" src="/js/components/sidebarComponent.js"></script>
    <script type="module" src="/js/modules/sidebarHandler.js"></script>
    
    <!-- Script de pruebas para categorías (desarrollo) -->
    <script src="/js/tests/categoryIntegrationTest.js"></script>
</body>
</html>